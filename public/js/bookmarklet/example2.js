javascript:(function(e){
    //THIS VARIABLES HAVE TO BE AUTOGENERATED
    var domain = "http://localhost:4000";
    //END OF AUTOGENERATED VARIABLES
    var doc = e.document;
    setTimeout(function(){
      var bid = "BPIPE_bookmarklet_iframe", elem = doc.getElementById(bid);
      if(elem){ return }
      function encode(data) {return encodeURIComponent(data).replace(/%20/g, '+');}
      function save(success) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', domain + '/bookmarklet/add',true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.withCredentials = true ;
        xhr.onreadystatechange=function() {
          if (xhr.readyState==4) success(JSON.parse(xhr.responseText)._id);
        }
        xhr.send("url="+encode(e.location.href)+"&parent="+parentFolder+"&title="+encode(doc.title)+"&width="+encode(doc.documentElement.clientWidth)+"&height="+encode(doc.documentElement.clientHeight)+"&html="+encode(doc.documentElement.innerHTML)+"&charset="+encode(doc.characterSet)+"&v=1.1");
      }
      function destroy() {
        var elem = doc.getElementById(bid);
        if(elem){ doc.body.removeChild( elem ); elem = null}
      }
      function process(e){
        if(e.origin !== domain) return;
        switch(e.data){
          case "save":  //This one redirects to the item in Browserpipe
            save(function(id){
              if(onClose==="redirect") window.location = domain + "/item/" + id;
              else if(onClose==="closetab") setTimeout(function(){var ww = window.open(window.location, '_self'); ww.close(); }, 1000);
              else destroy();
            }); break;
          case "destroy": destroy(); break;
        }
      }
      var s = doc.createElement("iframe");
      s.id= bid;
      s.src= domain;
      s.style.position= "fixed";
      s.style.top= "0";
      s.style.right= "0";
      s.style.height= "100%";
      s.style.width= "240px";
      s.style.zIndex= "16777270";
      s.style.border= "none";
      s.style.visibility= "hidden";
      s.onload=function(){ this.style.visibility="visible"; };
      doc.body.appendChild(s);
      var o=e.addEventListener?"addEventListener":"attachEvent";
      var u=o=="attachEvent"?"onmessage":"message";
      e[o](u,process,false)
    },1)
  }
)(window)
